"use strict";(self.webpackChunkkubrix=self.webpackChunkkubrix||[]).push([[247],{9961:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>i,default:()=>u,frontMatter:()=>a,metadata:()=>o,toc:()=>h});var r=n(4848),s=n(8453);const a={slug:"benefits-idp-distribution-quality-gates",title:"kubriX quality checks your headaches, time and costs",authors:["jkleinlercher"],keywords:["kubriX","benefits","quality checks"]},i="A real life example",o={permalink:"/blog/benefits-idp-distribution-quality-gates",editUrl:"https://github.com/suxess-it/website/tree/main/blog/2024-10-18-benefits-quality-gates/index.md",source:"@site/blog/2024-10-18-benefits-quality-gates/index.md",title:"kubriX quality checks your headaches, time and costs",description:"An IDP often consists of several products or opensource projects. Updating those components is one thing your platform team needs to do regularly for several reasons:",date:"2024-10-18T00:00:00.000Z",tags:[],readingTime:2.355,hasTruncateMarker:!1,authors:[{name:"Johannes Kleinlercher",title:"kubriX Dev, platform engineer, systems architect",url:"https://github.com/jkleinlercher",imageURL:"https://avatars.githubusercontent.com/u/11465610?v=4",key:"jkleinlercher",page:null}],frontMatter:{slug:"benefits-idp-distribution-quality-gates",title:"kubriX quality checks your headaches, time and costs",authors:["jkleinlercher"],keywords:["kubriX","benefits","quality checks"]},unlisted:!1,nextItem:{title:"Treat your platform as a product",permalink:"/blog/team-topologies-platform-engineering"}},l={authorsImageUrls:[void 0]},h=[];function c(e){const t={a:"a",code:"code",h1:"h1",img:"img",li:"li",p:"p",pre:"pre",ul:"ul",...(0,s.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(t.p,{children:"An IDP often consists of several products or opensource projects. Updating those components is one thing your platform team needs to do regularly for several reasons:"}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsx)(t.li,{children:"get the newest features"}),"\n",(0,r.jsx)(t.li,{children:"get bug fixes to increase stability"}),"\n",(0,r.jsx)(t.li,{children:"get security fixes to fulfill your vulnerability mgmt"}),"\n"]}),"\n",(0,r.jsx)(t.p,{children:"Those updates can be time-consuming and error-prone. However, kubriX keeps your platform up-to-date\nand our quality checks dramatically reduce your efforts and deployment risks."}),"\n",(0,r.jsx)(t.p,{children:"As the following real life example shows, sometimes updates can be really hard."}),"\n",(0,r.jsxs)(t.p,{children:["Recently a new version from ",(0,r.jsx)(t.a,{href:"https://github.com/grafana/helm-charts/releases/tag/mimir-distributed-5.5.0",children:"Grafana Mimir Helm-Chart 5.5.0"})," was released.\nI don't know wether you are a person who really evaluates changelogs before updates,\nbut also if you did read the ",(0,r.jsx)(t.a,{href:"https://github.com/grafana/mimir/blob/main/operations/helm/charts/mimir-distributed/CHANGELOG.md#550",children:"Changelog for 5.5.0"}),", you won't recognize any breaking changes."]}),"\n",(0,r.jsx)(t.p,{children:"However, the first time you would probably recognize a problem is that your Grafana Mimir ArgoCD application stays OutOfSync forever. If you take a closer look to the diff, you will see:"}),"\n",(0,r.jsx)(t.p,{children:(0,r.jsx)(t.img,{src:"https://github.com/user-attachments/assets/0786722a-7403-40bf-8b17-4504cdc2ee2f",alt:"image"})}),"\n",(0,r.jsx)(t.p,{children:"green (right side) is desired state, left is current state."}),"\n",(0,r.jsx)(t.p,{children:"You then probably ask yourself and your team mates why the hack this app doesn't sync anymore. Are there some conflicts with another app overriding this configuration? Is the Grafana Agent Operator overriding the GrafanaAgent instance? Is your GrafanaAgent CRD not compatible with this new GrafanaAgent after update? Where is this CRD defined? Do I need to have a look at new sync options ArgoCD provides (and they provide a lot of them)?"}),"\n",(0,r.jsx)(t.p,{children:"Beliefe me, this problem will take you hours even though you are very experiences, unless you have the right guess in the first place."}),"\n",(0,r.jsxs)(t.p,{children:["The problem was, that the ",(0,r.jsx)(t.a,{href:"https://github.com/grafana/agent/blob/69e7872651069b20cf9b8b67d9d210c1db245885/operations/agent-static-operator/crds/monitoring.grafana.com_grafanaagents.yaml",children:"GrafanaAgent CRD"})," supports the attribute ",(0,r.jsx)(t.code,{children:"topologySpreadConstraints"}),", but the indentation in the GrafanaAgent CR was wrong, so it was not compliant to the GrafanaAgent CRD spec."]}),"\n",(0,r.jsxs)(t.p,{children:["However, why did ArgoCD just show a OutOfSync problem? This is actually an ",(0,r.jsx)(t.a,{href:"https://github.com/argoproj/argo-cd/issues/16817",children:"open issue in ArgoCD"}),"."]}),"\n",(0,r.jsx)(t.p,{children:"When you apply the manifests manually, you would see"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{children:'Error from server (BadRequest): error when creating "STDIN": GrafanaAgent in version "v1alpha1" cannot be handled as a GrafanaAgent: strict decoding error: unknown field "spec.containers[1].topologySpreadConstraints"\nand indeed topologySpreadConstraints is not a valid attribute inside containers attribute.\n'})}),"\n",(0,r.jsx)(t.h1,{id:"the-benefits-of-kubrix",children:"The benefits of kubriX"}),"\n",(0,r.jsx)(t.p,{children:"We do those update tests for you already and will check already lots of things what otherwise your platform team needs to do. Only when our quality gates show a green light we integrate those new versions in our kubriX platform."}),"\n",(0,r.jsxs)(t.p,{children:["When we recognize problems like this above, we will ",(0,r.jsx)(t.a,{href:"https://github.com/grafana/mimir/issues/9638",children:"open an issue"})," on the original upstream project and help to ",(0,r.jsx)(t.a,{href:"https://github.com/grafana/mimir/pull/9670",children:"solve this problem"})," together with the maintainers."]}),"\n",(0,r.jsx)(t.p,{children:"Only for this problem above you will save at least 3-4 days updates, troubleshooting, communication with the community, and fixing the updates."}),"\n",(0,r.jsxs)(t.p,{children:["You can see our real life tests and investigations in this ",(0,r.jsx)(t.a,{href:"https://github.com/suxess-it/kubriX/pull/722#issuecomment-2412002619",children:"renovate PR"})]})]})}function u(e={}){const{wrapper:t}={...(0,s.R)(),...e.components};return t?(0,r.jsx)(t,{...e,children:(0,r.jsx)(c,{...e})}):c(e)}},8453:(e,t,n)=>{n.d(t,{R:()=>i,x:()=>o});var r=n(6540);const s={},a=r.createContext(s);function i(e){const t=r.useContext(a);return r.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function o(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:i(e.components),r.createElement(a.Provider,{value:t},e.children)}}}]);